# Garbage collector

Если мы хотим понять как работает GC то сначала нужно разобраться с понятиями Stack и Heap.

Stack
- локальный для потока (thread)
- быстрый
- начинается от 1 мб и расширяемый
- имеет stack pointer

Heap (куча)
- глобальный (доступен всем потокам)
- медленее чем Stack
- размер задается при старте приложения + динамический. Максимум - сколько на харде места

<br>

Heap имеет 3 вида:
- SOH - Small Object Heap
    - \< 85kb
    - хранит маленькие объекты
- LOH - Large Object Heap
    - \> 85 Kb
    - хранит большие объекты
    - не проводится дефрагментация
- POH - Pinned Object Heap
    - скорее всего здесь хранятся объекты используемые операциями unsafe и fixed

### Дефрагментация
Дефрагментация памяти это когда нужно положить объект в некий кусок памяти но по соседству лежит или лежат еще объекты и если объект который мы хотим положить не помещается то мы двигаем остальные чтобы на "полочке" появилось место, это называется дефрагментацией памяти. Некое упорядочивание областей памяти. Это дорогая операция.

### Garbage Collector
Garbage collector останавливает все приложение раз в некий период для оценки объектов и для очистки.
При оценке он смотрит используются ли объекты. Это проверяется удалены ли на объекты их ссылки. Если же объект используется, ему повышается номер поколения. При создании объекта автоматически задается поколение 0.

Garbage Collector в .NET оценивает объекты в рамках 3 поколений:
- 0 - при создании объекта ему сразу присваивается нулевое поколение
- 1 - среднее поколение
- 2 - сюда сразу попадают объекты с размером больше 85 Кб. Большие объекты чаще всего используются на длительной дистанции, по этому и присваивается поколение 2.

### Деструктор / Destructor
Деструктор - это как конструктор только обратный метод класса. Он вызывается при удалении объекта из памяти - "Предсмертный хрип". Нужен для освобождения неконтроллируемых ресурсов (бд, файлы, коннекты, и т.д.)

Пометка: объекты имеющие деструктор, удаляются не сразу но помещаются в очередь из которой вызываются деструкторы и удаляет их.
